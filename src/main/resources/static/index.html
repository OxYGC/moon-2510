<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ðŸŒ• ä¸­ç§‹è®¸æ„¿æ± </title>
    <style>
        body {
            margin: 0;
            background: #000;
            color: white;
            font-family: "Microsoft YaHei", sans-serif;
            overflow: hidden;
            height: 100vh;
        }
        #moon {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, #fff 60%, #ccc 100%);
            border-radius: 50%;
            box-shadow: 0 0 40px rgba(255, 255, 200, 0.6);
            z-index: 10;
        }
        #input-area {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 20;
        }
        input, button {
            padding: 10px 15px;
            font-size: 16px;
            border: none;
            border-radius: 20px;
        }
        input {
            width: 300px;
            background: rgba(255,255,255,0.1);
            color: white;
            outline: none;
        }
        button {
            background: #ff6b6b;
            color: white;
            cursor: pointer;
        }
        .wish {
            position: absolute;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            text-shadow: 0 0 8px rgba(255,255,255,0.8);
        }
    </style>
</head>
<body>
<div id="moon"></div>
<div id="input-area">
    <input type="text" id="wishInput" placeholder="å†™ä¸‹ä½ çš„ä¸­ç§‹æ„¿æœ›..." maxlength="50">
    <button onclick="submitWish()">è®¸æ„¿</button>
</div>

<script>
    const wishesContainer = document.body;
    const ws = new WebSocket('ws://localhost:8080/ws/wishes');

    // æäº¤æ„¿æœ›
    async function submitWish() {
        const input = document.getElementById('wishInput');
        const content = input.value.trim();
        if (!content) return;

        const res = await fetch('/api/wish', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content })
        });
        if (res.ok) input.value = '';
    }

    // æŽ¥æ”¶æ–°æ„¿æœ›ï¼ˆWebSocketï¼‰
    ws.onmessage = (event) => {
        const wish = JSON.parse(event.data);
        createFloatingWish(`${wish.content} â€”â€” ${wish.blessing}`);
    };



    // åˆ›å»ºé£˜åŠ¨æ„¿æœ›
    function createFloatingWish(text) {
        const el = document.createElement('div');
        el.className = 'wish';
        el.innerText = `âœ¨ ${text}`;
        el.style.left = (Math.random() * 80 + 10) + 'vw';
        el.style.color = `hsl(${Math.random() * 360}, 80%, 80%)`;
        el.style.fontSize = (14 + Math.random() * 6) + 'px'; // å­—ä½“å¤§å°éšæœºï¼Œæ›´è‡ªç„¶
        document.body.appendChild(el);

        // ðŸŒ• å…³é”®ï¼šå»¶é•¿åŠ¨ç”»æ—¶é—´ï¼ˆ15~25ç§’ï¼‰
        const duration = 15000 + Math.random() * 10000; // 15 åˆ° 25 ç§’

        // æ›´æŸ”å’Œçš„ç¼“åŠ¨æ›²çº¿
        el.animate([
            { top: '100vh', opacity: 0 },
            { top: '80vh', opacity: 0.8, offset: 0.05 },   // ç¼“æ…¢æ·¡å…¥
            { top: '40vh', opacity: 1, offset: 0.3 },       // ä¸­æ®µæœ€äº®
            { top: '10vh', opacity: 0.9, offset: 0.7 },
            { top: '-15vh', opacity: 0 }                    // æ·¡å‡ºæ¶ˆå¤±
        ], {
            duration: duration,
            easing: 'cubic-bezier(0.2, 0.8, 0.3, 1)'
        });

        // å»¶è¿Ÿç§»é™¤å…ƒç´ ï¼ˆç¡®ä¿åŠ¨ç”»å®Œæˆï¼‰
        setTimeout(() => {
            if (el.parentNode) el.remove();
        }, duration + 500);
    }




    // å›žè½¦æäº¤
    document.getElementById('wishInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') submitWish();
    });
</script>
</body>
</html>